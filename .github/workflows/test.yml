name: Tests and Coverage
on: [push, pull_request]
jobs:
  frontend:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup Node
      uses: actions/setup-node@v3
      with:
        node-version: 18.x
    - name: Install Frontend Dependencies
      working-directory: Frontend
      run: npm ci --silent
      env:
        NPM_CONFIG_LOGLEVEL: error
    - name: Run Frontend Tests
      working-directory: Frontend
      run: npm run test:coverage
      env:
        CI: true
        NODE_OPTIONS: --max-old-space-size=4096 --no-warnings
        # React Scripts specific
        GENERATE_SOURCEMAP: false
        # Suppress ESLint warnings in tests
        ESLINT_NO_DEV_ERRORS: true
        # Reduce npm noise but keep errors visible
        NPM_CONFIG_LOGLEVEL: error
    - name: Upload Frontend Coverage
      working-directory: Frontend
      run: npm run report:coverage --silent
      env:
        CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
        NPM_CONFIG_LOGLEVEL: error
  backend:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup Node
      uses: actions/setup-node@v3
      with:
        node-version: 18.x
    - name: Install Backend Dependencies
      working-directory: Backend
      run: npm ci --silent
      env:
        NPM_CONFIG_LOGLEVEL: error
    - name: Run Backend Tests
      working-directory: Backend
      run: npm run coverage --silent
      env:
        CI: true
        NODE_OPTIONS: --max-old-space-size=4096
        NPM_CONFIG_LOGLEVEL: error
        # Suppress specific warnings
        NODE_NO_WARNINGS: 1
        # Jest specific warning suppression
        JEST_SILENT: true
    - name: Upload Backend Coverage
      working-directory: Backend
      run: npm run report:coverage --silent
      env:
        CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
        NPM_CONFIG_LOGLEVEL: error
